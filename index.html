<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forex & Gold Scalping Calculator | Multi-Currency Position Sizing</title>
  <meta name="description" content="Professional position sizing calculator for major currency pairs and XAU/USD with risk management">
  
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --text: #e5e7eb;
      --text-muted: #94a3b8;
      --accent: #22c55e;
      --accent-hover: #16a34a;
      --danger: #ef4444;
      --warning: #eab308;
      --info: #3b82f6;
      --border: rgba(255, 255, 255, 0.1);
      --border-light: rgba(255, 255, 255, 0.05);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      --radius: 12px;
      --transition: all 0.2s ease;
    }

    [data-theme="light"] {
      --bg: #f8fafc;
      --card: #ffffff;
      --text: #1e293b;
      --text-muted: #64748b;
      --accent: #16a34a;
      --accent-hover: #15803d;
      --danger: #dc2626;
      --warning: #ca8a04;
      --info: #2563eb;
      --border: rgba(0, 0, 0, 0.1);
      --border-light: rgba(0, 0, 0, 0.05);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
      display: grid;
      place-items: center;
    }

    .app {
      width: 100%;
      max-width: 1000px;
      background: var(--card);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .header {
      margin-bottom: 30px;
      position: relative;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 6px;
      background: linear-gradient(135deg, var(--accent), var(--info));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 0.95rem;
      max-width: 700px;
    }

    .theme-toggle {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: var(--transition);
    }

    .theme-toggle:hover {
      background: var(--border-light);
      border-color: var(--accent);
    }

    .currency-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 15px;
    }

    .currency-badge {
      background: var(--border);
      color: var(--text);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
      border: 1px solid transparent;
      cursor: pointer;
      transition: var(--transition);
    }

    .currency-badge:hover {
      background: var(--border-light);
      border-color: var(--accent);
    }

    .currency-badge.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    .currency-badge.xau {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 24px;
    }

    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }

    .input-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .required::after {
      content: "*";
      color: var(--danger);
      margin-left: 2px;
    }

    input, select {
      padding: 12px 16px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      font-size: 1rem;
      transition: var(--transition);
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
    }

    input::placeholder {
      color: var(--text-muted);
      opacity: 0.7;
    }

    .currency-info {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 10px;
      padding: 12px;
      background: var(--border-light);
      border-radius: 8px;
      font-size: 0.875rem;
    }

    .currency-info .pip {
      font-weight: 600;
      color: var(--accent);
    }

    .currency-info .spread {
      font-weight: 600;
      color: var(--warning);
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 32px;
    }

    button {
      padding: 12px 24px;
      border-radius: 8px;
      border: none;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
      flex: 1;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border-light);
      border-color: var(--text-muted);
    }

    .result {
      margin-top: 32px;
      padding: 24px;
      background: var(--border-light);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .result.show {
      display: block;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    @media (max-width: 640px) {
      .result-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .result-grid {
        grid-template-columns: 1fr;
      }
    }

    .result-item {
      background: rgba(255, 255, 255, 0.03);
      padding: 20px;
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .result-item h3 {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .result-value {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--accent);
    }

    .status {
      margin-top: 20px;
      padding: 16px;
      border-radius: 8px;
      font-size: 0.95rem;
      display: none;
    }

    .status.show {
      display: block;
    }

    .status.success {
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.2);
      color: var(--accent);
    }

    .status.warning {
      background: rgba(234, 179, 8, 0.1);
      border: 1px solid rgba(234, 179, 8, 0.2);
      color: var(--warning);
    }

    .status.error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    .footer {
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
      font-size: 0.875rem;
      color: var(--text-muted);
    }

    .tip {
      background: rgba(34, 197, 94, 0.05);
      padding: 16px;
      border-radius: 8px;
      border-left: 4px solid var(--accent);
    }

    .tip strong {
      color: var(--accent);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .input-hint {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 4px;
      opacity: 0.8;
    }

    .currency-selector {
      margin-bottom: 20px;
    }

    .currency-selector label {
      margin-bottom: 10px;
      display: block;
    }

    .selected-currency {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--border-light);
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .selected-currency .symbol {
      font-weight: 700;
      font-size: 1.2rem;
    }

    .selected-currency .name {
      color: var(--text-muted);
      font-size: 0.9rem;
    }
  </style>
</head>
<body data-theme="dark">
  <div class="app">
    <div class="header">
      <div class="top-bar">
        <div>
          <h1>Multi-Currency Scalping Calculator</h1>
          <p class="subtitle">Professional position sizing calculator for major forex pairs and XAU/USD (Gold). Calculate optimal lot sizes, risk/reward ratios, and validate your setups.</p>
        </div>
        <button class="theme-toggle" id="themeBtn">
          <span class="theme-icon">üåô</span>
          <span class="theme-text">Dark Mode</span>
        </button>
      </div>

      <div class="currency-badges">
        <div class="currency-badge active" data-currency="EURUSD">EUR/USD</div>
        <div class="currency-badge" data-currency="GBPUSD">GBP/USD</div>
        <div class="currency-badge" data-currency="USDJPY">USD/JPY</div>
        <div class="currency-badge" data-currency="AUDUSD">AUD/USD</div>
        <div class="currency-badge" data-currency="USDCAD">USD/CAD</div>
        <div class="currency-badge" data-currency="NZDUSD">NZD/USD</div>
        <div class="currency-badge" data-currency="USDCHF">USD/CHF</div>
        <div class="currency-badge xau" data-currency="XAUUSD">XAU/USD (Gold)</div>
      </div>
    </div>

    <div class="currency-selector">
      <label>Selected Instrument:</label>
      <div class="selected-currency" id="selectedCurrency">
        <span class="symbol">EUR/USD</span>
        <span class="name">Euro vs US Dollar</span>
      </div>
    </div>

    <div class="grid">
      <div class="input-group">
        <label for="entry" class="required">Entry Price</label>
        <input 
          type="number" 
          id="entry" 
          step="0.00001" 
          placeholder="e.g., 1.07450"
          min="0.5"
          max="2"
        >
        <div class="input-hint">Current market price for selected instrument</div>
      </div>
      
      <div class="input-group">
        <label for="stop" class="required">Stop Loss Price</label>
        <input 
          type="number" 
          id="stop" 
          step="0.00001" 
          placeholder="e.g., 1.07350"
        >
        <div class="input-hint">Price where you'll exit to limit losses</div>
      </div>
      
      <div class="input-group">
        <label for="take" class="required">Take Profit Price</label>
        <input 
          type="number" 
          id="take" 
          step="0.00001" 
          placeholder="e.g., 1.07600"
        >
        <div class="input-hint">Price where you'll take profits</div>
      </div>
      
      <div class="input-group">
        <label for="balance" class="required">Account Balance (USD)</label>
        <input 
          type="number" 
          id="balance" 
          step="0.01" 
          placeholder="e.g., 10000"
          min="100"
        >
        <div class="input-hint">Your trading account balance in USD</div>
      </div>
      
      <div class="input-group">
        <label for="riskPct" class="required">Risk Per Trade (%)</label>
        <input 
          type="number" 
          id="riskPct" 
          step="0.01" 
          placeholder="e.g., 0.5"
          min="0.01"
          max="5"
          value="0.5"
        >
        <div class="input-hint">Recommended: 0.5% - 2% of account balance</div>
      </div>
      
      <div class="input-group">
        <label for="pipValue">Position Size Type</label>
        <select id="pipValue">
          <option value="10">Standard (1.0 lot = $10/pip)</option>
          <option value="1">Mini (0.1 lot = $1/pip)</option>
          <option value="0.1">Micro (0.01 lot = $0.10/pip)</option>
        </select>
        <div class="input-hint">Select based on your broker account type</div>
      </div>
    </div>

    <div class="currency-info" id="currencyInfo">
      <div><span class="pip">1 pip = 0.0001</span> (4th decimal)</div>
      <div>Typical spread: <span class="spread">0.6-1.2 pips</span></div>
      <div>Trading hours: London-NY overlap (13:00-16:00 GMT)</div>
    </div>

    <div class="actions">
      <button class="btn-primary" id="calcBtn">
        <span>üìä Calculate Position Size</span>
      </button>
      <button class="btn-secondary" id="resetBtn">
        <span>üîÑ Reset All</span>
      </button>
    </div>

    <div class="result" id="result">
      <h2 style="margin-bottom: 20px; color: var(--text);">Results for <span id="resultCurrency">EUR/USD</span></h2>
      <div class="result-grid">
        <div class="result-item">
          <h3>Pips to Stop Loss</h3>
          <div class="result-value" id="pipsStop">‚Äî</div>
        </div>
        <div class="result-item">
          <h3>Pips to Take Profit</h3>
          <div class="result-value" id="pipsTake">‚Äî</div>
        </div>
        <div class="result-item">
          <h3>Risk : Reward Ratio</h3>
          <div class="result-value" id="rr">‚Äî</div>
        </div>
        <div class="result-item">
          <h3>Risk Amount (USD)</h3>
          <div class="result-value" id="riskUsd">‚Äî</div>
        </div>
        <div class="result-item">
          <h3>Position Size (Lots)</h3>
          <div class="result-value" id="lots">‚Äî</div>
        </div>
        <div class="result-item">
          <h3>Position Units</h3>
          <div class="result-value" id="units">‚Äî</div>
        </div>
      </div>
    </div>

    <div class="status" id="status"></div>

    <div class="footer">
      <div class="tip">
        <p><strong>üí° Trading Information:</strong></p>
        <p><strong>EUR/USD:</strong> Most liquid pair, best during London/NY overlap (13:00-16:00 GMT)<br>
        <strong>GBP/USD:</strong> High volatility, watch for UK economic news (08:00 GMT)<br>
        <strong>USD/JPY:</strong> Lower spreads, influenced by BOJ and US yields (Tokyo session)<br>
        <strong>XAU/USD:</strong> 1 pip = $0.01, trades 24/5, higher spreads (0.3-0.8), high volatility</p>
      </div>
      <p style="margin-top: 16px; font-size: 0.8rem; opacity: 0.7;">
        Note: Pip values vary by pair. XAU/USD (Gold) uses $0.01 per pip for micro lots.<br>
        Disclaimer: This tool is for educational purposes. Trading involves risk of loss.
      </p>
    </div>
  </div>

  <script>
    class MultiCurrencyCalculator {
      constructor() {
        this.currencies = {
          EURUSD: {
            symbol: "EUR/USD",
            name: "Euro vs US Dollar",
            pipValue: 0.0001,
            typicalSpread: "0.6-1.2 pips",
            tradingHours: "London-NY overlap (13:00-16:00 GMT)",
            pipLabel: "1 pip = 0.0001 (4th decimal)",
            priceRange: { min: 0.8, max: 1.5 }
          },
          GBPUSD: {
            symbol: "GBP/USD",
            name: "British Pound vs US Dollar",
            pipValue: 0.0001,
            typicalSpread: "0.8-1.5 pips",
            tradingHours: "London session (08:00-16:00 GMT)",
            pipLabel: "1 pip = 0.0001 (4th decimal)",
            priceRange: { min: 1.1, max: 1.5 }
          },
          USDJPY: {
            symbol: "USD/JPY",
            name: "US Dollar vs Japanese Yen",
            pipValue: 0.01,
            typicalSpread: "0.5-1.0 pips",
            tradingHours: "Tokyo-London overlap (00:00-08:00 GMT)",
            pipLabel: "1 pip = 0.01 (2nd decimal)",
            priceRange: { min: 100, max: 160 }
          },
          AUDUSD: {
            symbol: "AUD/USD",
            name: "Australian Dollar vs US Dollar",
            pipValue: 0.0001,
            typicalSpread: "0.7-1.3 pips",
            tradingHours: "Sydney-Tokyo overlap (22:00-06:00 GMT)",
            pipLabel: "1 pip = 0.0001 (4th decimal)",
            priceRange: { min: 0.55, max: 0.85 }
          },
          USDCAD: {
            symbol: "USD/CAD",
            name: "US Dollar vs Canadian Dollar",
            pipValue: 0.0001,
            typicalSpread: "0.8-1.5 pips",
            tradingHours: "NY session (13:00-21:00 GMT)",
            pipLabel: "1 pip = 0.0001 (4th decimal)",
            priceRange: { min: 1.2, max: 1.5 }
          },
          NZDUSD: {
            symbol: "NZD/USD",
            name: "New Zealand Dollar vs US Dollar",
            pipValue: 0.0001,
            typicalSpread: "0.9-1.8 pips",
            tradingHours: "Wellington-Sydney (21:00-05:00 GMT)",
            pipLabel: "1 pip = 0.0001 (4th decimal)",
            priceRange: { min: 0.55, max: 0.75 }
          },
          USDCHF: {
            symbol: "USD/CHF",
            name: "US Dollar vs Swiss Franc",
            pipValue: 0.0001,
            typicalSpread: "0.8-1.5 pips",
            tradingHours: "London session (08:00-16:00 GMT)",
            pipLabel: "1 pip = 0.0001 (4th decimal)",
            priceRange: { min: 0.85, max: 1.05 }
          },
          XAUUSD: {
            symbol: "XAU/USD",
            name: "Gold vs US Dollar",
            pipValue: 0.01,
            typicalSpread: "0.3-0.8 pips",
            tradingHours: "24/5 (highest liquidity London-NY)",
            pipLabel: "1 pip = $0.01 (2nd decimal)",
            priceRange: { min: 1800, max: 2500 },
            isGold: true
          }
        };

        this.currentCurrency = 'EURUSD';
        this.initializeElements();
        this.setupEventListeners();
        this.loadPreferences();
      }

      initializeElements() {
        this.elements = {
          entry: document.getElementById('entry'),
          stop: document.getElementById('stop'),
          take: document.getElementById('take'),
          balance: document.getElementById('balance'),
          riskPct: document.getElementById('riskPct'),
          pipValue: document.getElementById('pipValue'),
          calcBtn: document.getElementById('calcBtn'),
          resetBtn: document.getElementById('resetBtn'),
          themeBtn: document.getElementById('themeBtn'),
          result: document.getElementById('result'),
          status: document.getElementById('status'),
          pipsStop: document.getElementById('pipsStop'),
          pipsTake: document.getElementById('pipsTake'),
          rr: document.getElementById('rr'),
          riskUsd: document.getElementById('riskUsd'),
          lots: document.getElementById('lots'),
          units: document.getElementById('units'),
          currencyInfo: document.getElementById('currencyInfo'),
          selectedCurrency: document.getElementById('selectedCurrency'),
          resultCurrency: document.getElementById('resultCurrency')
        };
      }

      setupEventListeners() {
        this.elements.calcBtn.addEventListener('click', () => this.calculate());
        this.elements.resetBtn.addEventListener('click', () => this.reset());
        this.elements.themeBtn.addEventListener('click', () => this.toggleTheme());
        
        // Currency selection
        document.querySelectorAll('.currency-badge').forEach(badge => {
          badge.addEventListener('click', (e) => {
            const currency = e.target.dataset.currency;
            this.selectCurrency(currency);
          });
        });

        // Auto-calculate on Enter
        const inputs = ['entry', 'stop', 'take', 'balance', 'riskPct'];
        inputs.forEach(id => {
          document.getElementById(id).addEventListener('keypress', (e) => {
            if (e.key === 'Enter') this.calculate();
          });
        });

        // Auto-fill example values based on currency
        this.elements.entry.addEventListener('focus', () => {
          if (!this.elements.entry.value) {
            const currency = this.currencies[this.currentCurrency];
            this.elements.entry.value = currency.priceRange.min + 
              ((currency.priceRange.max - currency.priceRange.min) * 0.5);
          }
        });
      }

      selectCurrency(currencyCode) {
        this.currentCurrency = currencyCode;
        const currency = this.currencies[currencyCode];
        
        // Update UI
        document.querySelectorAll('.currency-badge').forEach(badge => {
          badge.classList.remove('active');
        });
        document.querySelector(`[data-currency="${currencyCode}"]`).classList.add('active');
        
        // Update selected currency display
        this.elements.selectedCurrency.innerHTML = `
          <span class="symbol">${currency.symbol}</span>
          <span class="name">${currency.name}</span>
        `;
        
        // Update result currency display
        this.elements.resultCurrency.textContent = currency.symbol;
        
        // Update currency info
        this.elements.currencyInfo.innerHTML = `
          <div><span class="pip">${currency.pipLabel}</span></div>
          <div>Typical spread: <span class="spread">${currency.typicalSpread}</span></div>
          <div>Trading hours: ${currency.tradingHours}</div>
        `;
        
        // Update input placeholders and constraints
        const entryInput = this.elements.entry;
        entryInput.placeholder = `e.g., ${currency.priceRange.min.toFixed(currency.isGold ? 2 : 5)}`;
        entryInput.min = currency.priceRange.min * 0.8;
        entryInput.max = currency.priceRange.max * 1.2;
        entryInput.step = currency.isGold ? '0.01' : '0.00001';
        
        // Clear previous results
        this.resetResults();
        
        // Save preference
        localStorage.setItem('scalping-calculator-currency', currencyCode);
      }

      getInputValue(id) {
        const element = this.elements[id];
        const value = parseFloat(element.value);
        return isNaN(value) ? null : value;
      }

      calculatePipDistance(price1, price2) {
        const currency = this.currencies[this.currentCurrency];
        return Math.abs(price1 - price2) / currency.pipValue;
      }

      formatCurrency(amount) {
        return new Intl.NumberFormat('en-US', {
          style: 'currency',
          currency: 'USD',
          minimumFractionDigits: 2
        }).format(amount);
      }

      formatNumber(num, decimals = 3) {
        return new Intl.NumberFormat('en-US', {
          minimumFractionDigits: decimals,
          maximumFractionDigits: decimals
        }).format(num);
      }

      showStatus(message, type = 'error') {
        const status = this.elements.status;
        status.textContent = message;
        status.className = `status show ${type}`;
      }

      hideStatus() {
        this.elements.status.className = 'status';
      }

      calculate() {
        const currency = this.currencies[this.currentCurrency];
        
        // Get all input values
        const entry = this.getInputValue('entry');
        const stop = this.getInputValue('stop');
        const take = this.getInputValue('take');
        const balance = this.getInputValue('balance');
        const riskPct = this.getInputValue('riskPct');
        const pipValPerLot = parseFloat(this.elements.pipValue.value);

        // Validate inputs
        if ([entry, stop, take, balance, riskPct].some(v => v === null)) {
          this.showStatus('Please fill in all required fields.', 'error');
          return;
        }

        if (entry <= 0 || stop <= 0 || take <= 0) {
          this.showStatus('Prices must be positive numbers.', 'error');
          return;
        }

        // Validate price ranges for selected currency
        if (entry < currency.priceRange.min * 0.5 || entry > currency.priceRange.max * 1.5) {
          this.showStatus(`Entry price seems unusual for ${currency.symbol}. Typical range: ${currency.priceRange.min} - ${currency.priceRange.max}`, 'warning');
        }

        if (balance < 100) {
          this.showStatus('Account balance should be at least $100.', 'warning');
        }

        if (riskPct < 0.01 || riskPct > 5) {
          this.showStatus('Risk % should be between 0.01% and 5%.', 'error');
          return;
        }

        // Validate trade direction
        if ((take > entry && stop > entry) || (take < entry && stop < entry)) {
          this.showStatus('Stop loss should be on opposite side of entry from take profit.', 'error');
          return;
        }

        // Calculate metrics
        const pipsStop = this.calculatePipDistance(entry, stop);
        const pipsTake = this.calculatePipDistance(entry, take);
        const rrRatio = pipsTake / pipsStop;
        const riskUsd = balance * (riskPct / 100);
        
        // Calculate position size
        let lots = riskUsd / (pipsStop * pipValPerLot);
        
        // Apply reasonable limits
        const maxLots = currency.isGold ? 100 : 1000; // Lower max for gold due to higher value
        lots = Math.min(Math.max(lots, 0.001), maxLots);
        
        const units = lots * (currency.isGold ? 100 : 100000); // Gold: 1 lot = 100 oz, Forex: 1 lot = 100,000 units

        // Update UI with results
        this.elements.pipsStop.textContent = this.formatNumber(pipsStop, 1);
        this.elements.pipsTake.textContent = this.formatNumber(pipsTake, 1);
        this.elements.rr.textContent = this.formatNumber(rrRatio, 2);
        this.elements.riskUsd.textContent = this.formatCurrency(riskUsd);
        this.elements.lots.textContent = this.formatNumber(lots, 3);
        this.elements.units.textContent = Math.round(units).toLocaleString();

        // Show results section
        this.elements.result.classList.add('show');

        // Set status based on analysis
        this.analyzeTrade(pipsStop, rrRatio, riskPct, lots, currency);
        
        // Save preferences
        this.savePreferences();
      }

      analyzeTrade(pipsStop, rrRatio, riskPct, lots, currency) {
        let message = '';
        let type = 'success';

        const minPips = currency.isGold ? 50 : 3; // Gold requires larger stops
        const maxPips = currency.isGold ? 500 : 30;

        if (pipsStop < minPips) {
          message = `‚ö†Ô∏è Stop loss is very tight (under ${minPips} pips). ${currency.isGold ? 'Gold requires wider stops due to volatility.' : 'Consider spread impact.'}`;
          type = 'warning';
        } else if (pipsStop > maxPips) {
          message = `‚ö†Ô∏è Stop loss is wide (over ${maxPips} pips). This may not be scalping.`;
          type = 'warning';
        } else if (rrRatio < 1) {
          message = '‚ö†Ô∏è Risk:Reward is below 1:1. Consider adjusting your targets.';
          type = 'warning';
        } else if (rrRatio >= (currency.isGold ? 1.2 : 1.5)) {
          message = `‚úÖ Good risk:reward ratio for ${currency.symbol}!`;
          type = 'success';
        } else {
          message = `üìà Setup is acceptable for ${currency.symbol}.`;
          type = 'success';
        }

        if (riskPct > 2) {
          message += ' Risk percentage is high for scalping.';
          type = 'warning';
        }

        const maxLotsForCurrency = currency.isGold ? 20 : 50;
        if (lots > maxLotsForCurrency) {
          message += ` Position size is large for ${currency.symbol} - ensure sufficient margin.`;
          type = 'warning';
        }

        this.showStatus(message, type);
      }

      reset() {
        // Clear all inputs
        this.elements.entry.value = '';
        this.elements.stop.value = '';
        this.elements.take.value = '';
        this.elements.balance.value = '';
        this.elements.riskPct.value = '0.5';
        this.elements.pipValue.value = '10';

        // Reset results
        this.resetResults();

        // Focus on first input
        this.elements.entry.focus();
      }

      resetResults() {
        this.elements.result.classList.remove('show');
        this.hideStatus();
        
        // Reset result values
        this.elements.pipsStop.textContent = '‚Äî';
        this.elements.pipsTake.textContent = '‚Äî';
        this.elements.rr.textContent = '‚Äî';
        this.elements.riskUsd.textContent = '‚Äî';
        this.elements.lots.textContent = '‚Äî';
        this.elements.units.textContent = '‚Äî';
      }

      toggleTheme() {
        const body = document.body;
        const isDark = body.getAttribute('data-theme') === 'dark';
        const newTheme = isDark ? 'light' : 'dark';
        
        body.setAttribute('data-theme', newTheme);
        
        const themeBtn = this.elements.themeBtn;
        const icon = themeBtn.querySelector('.theme-icon');
        const text = themeBtn.querySelector('.theme-text');
        
        icon.textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
        text.textContent = newTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
        
        localStorage.setItem('scalping-calculator-theme', newTheme);
      }

      loadPreferences() {
        // Load theme preference
        const savedTheme = localStorage.getItem('scalping-calculator-theme');
        if (savedTheme) {
          document.body.setAttribute('data-theme', savedTheme);
          const themeBtn = this.elements.themeBtn;
          const icon = themeBtn.querySelector('.theme-icon');
          const text = themeBtn.querySelector('.theme-text');
          
          icon.textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
          text.textContent = savedTheme === 'dark' ? 'Dark Mode' : 'Light Mode';
        }

        // Load currency preference
        const savedCurrency = localStorage.getItem('scalping-calculator-currency');
        if (savedCurrency && this.currencies[savedCurrency]) {
          this.selectCurrency(savedCurrency);
        }

        // Try to load last inputs
        try {
          const saved = localStorage.getItem('scalping-calculator-inputs');
          if (saved) {
            const inputs = JSON.parse(saved);
            Object.keys(inputs).forEach(key => {
              if (this.elements[key]) {
                this.elements[key].value = inputs[key];
              }
            });
          }
        } catch (e) {
          console.log('No saved inputs found');
        }
      }

      savePreferences() {
        const inputs = {
          entry: this.elements.entry.value,
          stop: this.elements.stop.value,
          take: this.elements.take.value,
          balance: this.elements.balance.value,
          riskPct: this.elements.riskPct.value,
          pipValue: this.elements.pipValue.value
        };
        
        localStorage.setItem('scalping-calculator-inputs', JSON.stringify(inputs));
      }
    }

    // Initialize the calculator when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      new MultiCurrencyCalculator();
    });
  </script>
</body>
</html>
